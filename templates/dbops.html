{% extends "base.html" %}
{% block content %}
<h2>Database Operations</h2>
<p class="muted">Call stored procedures and functions. The Trigger Demonstration at the end proves all three AidDistribution triggers.</p>

<!-- DistributeAid -->
<article>
  <header><strong>Procedure:</strong> DistributeAid(volunteerId, victimId, resourceId, qty, date?)</header>
  <form method="post" class="grid4">
    <input name="d_vol"  placeholder="VolunteerID (e.g., 201)">
    <input name="d_vic"  placeholder="VictimID (e.g., 301)">
    <input name="d_res"  placeholder="ResourceID (e.g., 401)">
    <input name="d_qty"  placeholder="Qty (e.g., 2)">
    <input name="d_date" placeholder="Date YYYY-MM-DD (optional)">
    <input type="hidden" name="action" value="distribute">
    <button>Run DistributeAid()</button>
  </form>
</article>

<!-- assign_volunteer -->
<article>
  <header><strong>Procedure:</strong> assign_volunteer(campId, volunteerId, date)</header>
  <form method="post" class="grid3">
    <input name="a_camp" placeholder="CampID (e.g., 101)">
    <input name="a_vol"  placeholder="VolunteerID (e.g., 201)">
    <input name="a_date" placeholder="Date YYYY-MM-DD (optional → today)">
    <input type="hidden" name="action" value="assign">
    <button>Run assign_volunteer()</button>
  </form>
</article>

<!-- camp_occupancy_for -->
<article>
  <header><strong>Function:</strong> camp_occupancy_for(campId) → % occupancy</header>
  <form method="post" class="grid2">
    <input name="occ_camp" placeholder="CampID (e.g., 101)">
    <input type="hidden" name="action" value="occ_for">
    <button>Get Occupancy</button>
  </form>
</article>

<!-- CountVictimsInCamp -->
<article>
  <header><strong>Function:</strong> CountVictimsInCamp(campId) → count</header>
  <form method="post" class="grid2">
    <input name="c_camp" placeholder="CampID (e.g., 101)">
    <input type="hidden" name="action" value="count">
    <button>Count Victims</button>
  </form>
</article>

<!-- Trigger Demonstration -->
<article>
  <header><strong>Trigger Demonstration (AidDistribution)</strong></header>
  <p class="muted">
    This section proves the three triggers: BEFORE INSERT blocks negative quantity; AFTER INSERT decrements stock; AFTER DELETE restores stock.
  </p>

  <form method="post" class="grid4">
    <input name="t_vol"  placeholder="VolunteerID (e.g., 201)">
    <input name="t_vic"  placeholder="VictimID (e.g., 301)">
    <input name="t_res"  placeholder="ResourceID (e.g., 401)">
    <input name="t_qty"  placeholder="Qty for valid insert (e.g., 4)">
    <input name="t_date" placeholder="Date YYYY-MM-DD (blank → today)">

    <button type="submit" name="action" value="trg_neg" style="grid-column: span 2;">1) BEFORE INSERT: try negative qty (should be blocked)</button>
    <button type="submit" name="action" value="trg_ok"  style="grid-column: span 1;">2) AFTER INSERT: valid insert (decrement stock)</button>
    <button type="submit" name="action" value="trg_del" style="grid-column: span 1;">3) AFTER DELETE: delete same row (restore stock)</button>
  </form>

  <small class="muted">
    Suggested test IDs: 201 / 301 / 401 and date 2024-07-03.  
    After step 2 you should see stock “before → after” decreased. After step 3 it should be restored.
  </small>
</article>
{% endblock %}
